<?xml version="1.0" encoding="UTF-8"?>
<!--

    Sonatype Nexus (TM) Open Source Version
    Copyright (c) 2007-2013 Sonatype, Inc.
    All rights reserved. Includes the third-party code listed at http://links.sonatype.com/products/nexus/oss/attributions.

    This program and the accompanying materials are made available under the terms of the Eclipse Public License Version 1.0,
    which accompanies this distribution and is available at http://www.eclipse.org/legal/epl-v10.html.

    Sonatype Nexus (TM) Professional Version is available from Sonatype, Inc. "Sonatype" and "Sonatype Nexus" are trademarks
    of Sonatype, Inc. Apache Maven is a trademark of the Apache Software Foundation. M2eclipse is a trademark of the
    Eclipse Foundation. All other trademarks are the property of their respective owners.

-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.sonatype.nexus</groupId>
    <artifactId>nexus-oss</artifactId>
    <version>2.5.0-SNAPSHOT</version>
    <relativePath>../../pom.xml</relativePath>
  </parent>

  <groupId>org.sonatype.nexus</groupId>
  <artifactId>nexus</artifactId>
  <packaging>pom</packaging>

  <properties>
    <!-- Default debug friendly options -->
    <maven.yuicompressor.nocompress>true</maven.yuicompressor.nocompress>
    <maven.yuicompressor.nomunge>true</maven.yuicompressor.nomunge>
    <maven.yuicompressor.disableOptimizations>true</maven.yuicompressor.disableOptimizations>
    <!-- preserve linebreaks -->
    <maven.yuicompressor.linebreakpos>0</maven.yuicompressor.linebreakpos>

    <!-- logging configuration used in logback config files to control test logging -->
    <test.log.level>INFO</test.log.level>
    <it.test.log.level>INFO</it.test.log.level>
    <it.nexus.log.level>INFO</it.nexus.log.level>

    <it.nexus.bundle.groupId>org.sonatype.nexus</it.nexus.bundle.groupId>
    <it.nexus.bundle.artifactId>nexus-oss-webapp</it.nexus.bundle.artifactId>
    <it.nexus.bundle.version>${project.version}</it.nexus.bundle.version>
  </properties>

  <dependencyManagement>
    <dependencies>

      <!-- INTERNAL -->

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-bootstrap</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus.client</groupId>
        <artifactId>nexus-client-core</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-compat</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-configuration-model</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-repository-metadata-model</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-repository-metadata-api</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-core</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-core</artifactId>
        <version>2.5.0-SNAPSHOT</version>
        <classifier>tests</classifier>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-launcher</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-logging-extras</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-logging-extras-appender</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-oss-edition</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-web-utils</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-webapp</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-webapp</artifactId>
        <type>war</type>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-test-common</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-oss-webapp</artifactId>
        <version>2.5.0-SNAPSHOT</version>
        <classifier>bundle</classifier>
        <type>zip</type>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-plugin-api</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-plugin-test-api</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-test-harness-launcher</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-testsuite-client</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-testsuite-support</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-test-utils</artifactId>
        <version>2.5.0-SNAPSHOT</version>
      </dependency>
    </dependencies>
  </dependencyManagement>

  <modules>
    <module>nexus-bootstrap</module>
    <module>nexus-plugin-api</module>
    <module>nexus-plugin-test-api</module>
    <module>nexus-core</module>
    <module>nexus-web-utils</module>
    <module>nexus-logging-extras</module>
    <module>nexus-logging-extras-appender</module>
    <module>nexus-repository-metadata-model</module>
    <module>nexus-repository-metadata-api</module>
    <module>nexus-compat</module>
    <module>nexus-oss-edition</module>
    <module>nexus-configuration-model</module>
    <module>plugin-parent</module>
    <module>plugins</module>
    <module>nexus-webapp</module>
    <module>nexus-launcher</module>
    <module>nexus-client-core</module>
    <module>nexus-oss-webapp</module>
    <module>nexus-stories</module>
    <module>nexus-test</module>
    <module>nexus-client-core-testsuite</module>
  </modules>

  <build>
    <pluginManagement>
      <plugins>

        <!--
        FIXME: This is still needed here, as there are some nexus-plugins defined outside of the plugins group
        FIXME: (nexus-it-helper-plugin for one, maybe needed for nexus-test-harness-its too).
        -->
        <plugin>
          <groupId>org.sonatype.nexus</groupId>
          <artifactId>nexus-plugin-bundle-maven-plugin</artifactId>
          <version>1.0</version>
          <extensions>true</extensions>
        </plugin>

        <plugin>
          <groupId>org.sonatype.plugins</groupId>
          <artifactId>modello-plugin-upgrade</artifactId>
          <version>1.0</version>
        </plugin>

        <plugin>
          <!-- TODO this is only used by nexus-webapp, move this there -->
          <groupId>org.sonatype.plugins</groupId>
          <artifactId>yuicompressor-maven-plugin</artifactId>
          <version>1.0.0</version>
          <configuration>
            <!--
               yuicompressor warns when code is not in a shape that's optimized for minifying.
               ATM this only pollutes the log (~9400 warnings)
            -->
            <jswarn>false</jswarn>
            <nominify>${maven.yuicompressor.nocompress}</nominify>
            <nomunge>${maven.yuicompressor.nomunge}</nomunge>
            <disableOptimizations>${maven.yuicompressor.disableOptimizations}</disableOptimizations>
            <linebreakpos>${maven.yuicompressor.linebreakpos}</linebreakpos>
          </configuration>
          <executions>
            <execution>
              <id>js</id>
              <goals>
                <goal>aggregate</goal>
              </goals>
              <configuration>
                <output>${project.build.outputDirectory}/static/js/${project.artifactId}-all.js</output>
              </configuration>
            </execution>
            <execution>
              <id>css</id>
              <goals>
                <goal>aggregate-css</goal>
              </goals>
              <configuration>
                <output>${project.build.outputDirectory}/static/css/${project.artifactId}-all.css</output>
                <required>false</required>
              </configuration>
            </execution>
          </executions>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-assembly-plugin</artifactId>
          <!--
          NOTE: 2.2-beta-3 is the latest version which does not have issues setting file/directory mode permissions in archives
          NOTE: (2.3 which is the latest available, is better, but still has problems with directorySet outputDirectory permissions)
          -->
          <version>2.2-beta-3</version>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-surefire-plugin</artifactId>
          <configuration>
            <!--
            FIXME: Some tests do not root properly, should be update to use TestSupport util.resolve* helpers; leave default for now
            https://issues.sonatype.org/browse/NEXUS-5345
            -->
            <!--<workingDirectory>${project.build.directory}</workingDirectory>-->
            <systemPropertyVariables combine.children="append">
              <!-- start junit benchmarks config -->
              <jub.consumers>H2,CONSOLE</jub.consumers>
              <jub.db.file>.benchmarks</jub.db.file>
              <jub.customkey>${os.name}</jub.customkey>
              <jub.charts.dir>${project.build.directory}/junit-benchmarks</jub.charts.dir>
              <!-- end junit benchmarks config -->
              <!-- logging configuration properties, see logback*.xml files -->
              <test.log.level>${test.log.level}</test.log.level>
              <it.test.log.level>${it.test.log.level}</it.test.log.level>
              <it.nexus.log.level>${it.nexus.log.level}</it.nexus.log.level>
            </systemPropertyVariables>
          </configuration>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-failsafe-plugin</artifactId>
          <configuration>
            <forkMode>once</forkMode>
            <!--
            FIXME: Some tests do not root properly, should be update to use TestSupport util.resolve* helpers; leave default for now
            https://issues.sonatype.org/browse/NEXUS-5345
            -->
            <!--<workingDirectory>${project.build.directory}</workingDirectory>-->
            <excludes combine.children="append">
              <exclude>**/Abstract*</exclude>
            </excludes>
            <systemPropertyVariables combine.children="append">
              <!-- logging configuration properties, see logback*.xml files -->
              <test.log.level>${test.log.level}</test.log.level>
              <it.test.log.level>${it.test.log.level}</it.test.log.level>
              <it.nexus.log.level>${it.nexus.log.level}</it.nexus.log.level>
            </systemPropertyVariables>
          </configuration>
        </plugin>

        <plugin>
          <groupId>org.sonatype.plugins</groupId>
          <artifactId>provided-dependencies-maven-plugin</artifactId>
          <version>1.6</version>
        </plugin>

        <!--<plugin>-->
        <!--<groupId>com.mycila.maven-license-plugin</groupId>-->
        <!--<artifactId>maven-license-plugin</artifactId>-->
        <!--<configuration>-->
        <!--&lt;!&ndash; caution do not append children excludes since we have 'target' package &ndash;&gt;-->
        <!--<excludes>-->
        <!--<exclude>**/.*/**</exclude>-->
        <!--&lt;!&ndash; we have target pattern in this format because of target package in nexus-core modules &ndash;&gt;-->
        <!--<exclude>**/nexus*/target/**</exclude>-->
        <!--<exclude>**/ldap-common/target/**</exclude>-->
        <!--<exclude>plugin*/**/target/**</exclude>-->
        <!--<exclude>**/ext-3.4.1.1/**</exclude>-->
        <!--<exclude>**/js/filetree/**</exclude>-->
        <!--<exclude>**/editarea_0_8_2/**</exclude>-->
        <!--<exclude>**/org/sonatype/security/ldap/dao/password/hash/MD5Crypt.java</exclude>-->
        <!--&lt;!&ndash; FIXME is this really a good idea excluding all test resources? &ndash;&gt;-->
        <!--<exclude>**/src/test/resources/**</exclude>-->
        <!--<exclude>**/src/test/filtered-resources/**</exclude>-->
        <!--<exclude>**/nexus-test-harness-its/resources/**</exclude>-->
        <!--<exclude>**/gwt/ext/ui/**/*.js</exclude>-->
        <!--<exclude>**/gwt/ext/ui/**/*.css</exclude>-->
        <!--&lt;!&ndash; already has a lgpl license &ndash;&gt;-->
        <!--<exclude>**/Ext.ux.form.LovCombo.css</exclude>-->
        <!--&lt;!&ndash; temp file created by maven-shade-plugin in basedir, deleted on maven jvm exit but possibly still around during license check &ndash;&gt;-->
        <!--<exclude>**/dependency-reduced-pom.xml</exclude>-->
        <!--&lt;!&ndash; netbeans adds these &ndash;&gt;-->
        <!--<exclude>**/nbactions*.xml</exclude>-->
        <!--<exclude>**/nb-configuration.xml</exclude>-->
        <!--&lt;!&ndash; IntelliJ IDEA files&ndash;&gt;-->
        <!--<exclude>**/atlassian-ide-plugin.xml</exclude>-->
        <!--<exclude>plugins/nexus-ui-extjs3-plugin/src/main/resources/static/js/ext/ux/**</exclude>-->
        <!--<exclude>plugins/nexus-ui-extjs3-plugin/src/main/resources/static/css/ext/ux/**</exclude>-->
        <!--<exclude>plugins/nexus-ui-extjs3-plugin/src/main/js-lib/**</exclude>-->
        <!--</excludes>-->
        <!--</configuration>-->
        <!--</plugin>-->

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-release-plugin</artifactId>
          <configuration>
            <releaseProfiles>release,tattletale,optimize-js</releaseProfiles>
            <tagNameFormat>nexus-@{version}</tagNameFormat>
          </configuration>
        </plugin>

        <!-- INTERNAL -->

        <plugin>
          <groupId>org.sonatype.nexus.plugins</groupId>
          <artifactId>nexus-test-environment-maven-plugin</artifactId>
          <version>2.5.0-SNAPSHOT</version>
        </plugin>

      </plugins>
    </pluginManagement>

    <plugins>
      <plugin>
        <groupId>org.codehaus.plexus</groupId>
        <artifactId>plexus-component-metadata</artifactId>
      </plugin>
    </plugins>
  </build>

  <profiles>
    <profile>
      <id>debug</id>
      <activation>
        <property>
          <name>debug</name>
          <value>true</value>
        </property>
      </activation>
      <properties>
        <!-- configure test logging properties to debug levels -->
        <test.log.level>DEBUG</test.log.level>
        <it.test.log.level>DEBUG</it.test.log.level>
        <it.nexus.log.level>DEBUG</it.nexus.log.level>
      </properties>
    </profile>

    <profile>
      <id>it</id>
      <activation>
        <property>
          <name>it</name>
          <value>true</value>
        </property>
      </activation>
      <build>
        <plugins>
          <plugin>
            <groupId>org.sonatype.plugins</groupId>
            <artifactId>sisu-maven-bridge-maven-plugin</artifactId>
            <version>3.0</version>
            <executions>
              <execution>
                <goals>
                  <goal>export</goal>
                </goals>
              </execution>
            </executions>
          </plugin>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-failsafe-plugin</artifactId>
            <executions>
              <execution>
                <goals>
                  <goal>integration-test</goal>
                  <goal>verify</goal>
                </goals>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

    <profile>
      <id>optimize-js</id>

      <properties>
        <!--
        'munge' means obfuscating the code by replacing variable names with short one-letter names. This makes
        understanding reported UI errors harder and the size increase is only 4%, so let's turn this off for now.
        -->
        <maven.yuicompressor.nomunge>true</maven.yuicompressor.nomunge>
        <maven.yuicompressor.nocompress>false</maven.yuicompressor.nocompress>
        <maven.yuicompressor.disableOptimizations>false</maven.yuicompressor.disableOptimizations>
        <!-- do not preserve linebreaks -->
        <maven.yuicompressor.linebreakpos>-1</maven.yuicompressor.linebreakpos>
      </properties>
    </profile>
  </profiles>
</project>
